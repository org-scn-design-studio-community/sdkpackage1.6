/**
 * BYO Data Component Property Handler
 */
var propertyPageHandlerRegistry = propertyPageHandlerRegistry || [];
/**
 * Register Handler
 */
propertyPageHandlerRegistry.push({
	id : "byodata",
	setter : function(property, value){
		this["cmp_"+property].setValue(value);
	},
	getter : function(property, control){
		return control.getValue();
	},
	createComponent : function(property, propertyOptions, changeHandler){
		var component = new org.scn.community.aps.BYOData({
			text : "Data",
			showCollapseIcon : false,
			width : "100%"
		});
		component.attachValueChange(changeHandler ,this);
		return component;
	}
});

sap.ui.commons.Panel.extend("org.scn.community.aps.BYOData", {  
	needsLabel : function() {
		return false;
	},
	metadata: {  
        properties :  {  
            "value": {
            	type : "string",
            	defaultValue : ""
            }  
        },
        events : {
	    	valueChange : {}
	    }     
    },
    setValue : function(s){
		sap.ui.core.Control.prototype.setProperty.apply(this,["value",s]);
		this._data = [];
		var dataString = s.replace(/~\|~/g,"\n");
		var sd = dataString.split("\n");
		for(var i=0;i<sd.length;i++){
			this._data.push(sd[i].split(","));
		}
		this.updateProps();
		return this;
	},
	getValue : function(){
		//return this._data;
		var d = [];
		for(var i=0;i<this._data.length;i++){
			var r = this._data[i].join(",");
			d.push(r);
		}
		return d.join("\n");
		return sap.ui.core.Control.prototype.getProperty.apply(this,["value"]);
	},
    renderer : { },
    init : function(){
    	this._data = [];
    	this.presets = [
    	    {
    	    	label : "Grocery Store",
    	    	dimensions : 2,
    	    	data : [
    	    	   ["Department","Product","Sales","Quantity"],
    	    	   ["Produce","Apples",100,20],
    	    	   ["Produce","Oranges",75,15],
    	    	   ["Produce","Kiwis",30,5],
    	    	   ["Produce","Bananas",150,30],
    	    	   ["Grocery","Cereal",34,20],
    	    	   ["Grocery","Juice",25,15],
    	    	   ["Grocery","Coffee",17,5],
    	    	   ["Meat","Poultry",150,30],
    	    	   ["Meat","Pork",78,23]
    	    	]
    	    },{
    	    	label : "Web Traffic",
    	    	dimensions : 1,
    	    	data : [
    	    	   ["Date","Hits","Unique Visitors"],
    	    	   ["01/2014",1020,23],
    	    	   ["02/2014",929,19],
    	    	   ["03/2014",837,20],
    	    	   ["04/2014",940,22],
    	    	   ["05/2014",736,13],
    	    	   ["06/2014",674,10],
    	    	   ["07/2014",910,25],
    	    	   ["08/2014",1200,29],
    	    	   ["09/2014",980,34],
    	    	   ["10/2014",1087,45],
    	    	   ["11/2014",1350,89],
    	    	   ["12/2014",1510,102]
    	    	]
    	    },{
    	    	label : "Schools",
    	    	dimensions : 6,
    	    	data : [
    				["Location","City","State","Zip Code","Longitude","Latitude","Students"],
    				["University of Alabama at Birmingham","Birmingham","AL","35294-0110","-86.80446","33.50096",4401],
    				["Amridge University","Montgomery","AL","36117-3553","-86.171548","32.365021",2021],
    				["University of Alabama at Huntsville","Huntsville","AL","35899","-86.643936","34.723896",3302],
    				["Alabama State University","Montgomery","AL","36101-0271","-86.296158","32.36623",3972],
    				["University of Alabama System Office","Tuscaloosa","AL","35401","-87.560429","33.213047",2914],
    				["The University of Alabama","Tuscaloosa","AL","35487-0166","-87.54234","33.208811",2748],
    				["Central Alabama Community College","Alexander City","AL","35010","-85.947875","32.924383",1898],
    				["Athens State University","Athens","AL","35611","-86.967621","34.805512",2873],
    				["Auburn University at Montgomery","Montgomery","AL","36117-3596","-86.17771","32.36839",2635],
    				["Auburn University","Auburn University","AL","36849","-85.486107","32.603383",2944],
    				["Birmingham Southern College","Birmingham","AL","35254","-86.850359","33.517202",4469],
    				["Chattahoochee Valley Community College","Phenix City","AL","36869","-85.028995","32.428862",1045],
    				["Concordia College-Selma","Selma","AL","36701","-87.0177","32.4254",4170],
    				["South University-Montgomery","Montgomery","AL","36116-1120","-86.217741","32.342503",2345],
    				["Enterprise State Community College","Enterprise","AL","36330-1300","-85.835009","31.299651",2061],
    				["James H Faulkner State Community College","Bay Minette","AL","36507-2698","-87.776669","30.852589",1513],
    				["Faulkner University","Montgomery","AL","36109-3378","-86.216358","32.381918",1103],
    				["Gadsden State Community College","Gadsden","AL","35903","-85.98997","33.994979",4708],
    				["George C Wallace State Community College-Dothan","Dothan","AL","36303-9234","-85.46796","31.31592",1899],
    				["George C Wallace State Community College-Hanceville","Hanceville","AL","35077-2000","-86.778259","34.072755",3252],
    				["George C Wallace State Community College-Selma","Selma","AL","36703-2808","-87.014531","32.444291",4287],
    				["Herzing University-Birmingham","Birmingham","AL","35209","-86.832344","33.468136",1521],
    				["Huntingdon College","Montgomery","AL","36106-2148","-86.285285","32.352002",4362],
    				["Heritage Christian University","Florence","AL","35630-9977","-87.660709","34.860679",3629],
    				["J F Drake State Technical College","Huntsville","AL","35811","-86.572561","34.771174",2166],
    				["J F Ingram State Technical College","Deatsville","AL","36022","-86.381859","32.576179",2648],
    				["Jacksonville State University","Jacksonville","AL","36265","-85.763653","33.824096",4530],
    				["Jefferson Davis Community College","Brewton","AL","36426","-87.08423","31.10199",3832],
    				["Jefferson State Community College","Birmingham","AL","35215-3098","-86.709463","33.651085",2056],
    				["John C Calhoun State Community College","Tanner","AL","35671","-86.94908","34.64771",3277],
    				["Judson College","Marion","AL","36756","-87.316603","32.629662",1027],
    				["Lawson State Community College-Birmingham Campus","Birmingham","AL","35221-1717","-86.888372","33.449443",1922],
    				["University of West Alabama","Livingston","AL","35470","-88.18725","32.5843",2067],
    				["Lurleen B Wallace Community College","Andalusia","AL","36420-1418","-86.451742","31.321861",1826],
    				["Marion Military Institute","Marion","AL","36756","-87.318077","32.622556",4566],
    				["Miles College","Fairfield","AL","35064-2621","-86.90718","33.48072",3080],
    				["University of Mobile","Mobile","AL","36613-2842","-88.128739","30.793454",1404],
    				["University of Montevallo","Montevallo","AL","35115-6000","-86.86473","33.10442",2560],
    				["Northwest Shoals Community College-Muscle Shoals","Muscle Shoals","AL","35661","-87.678939","34.730351",3036],
    				["University of North Alabama","Florence","AL","35632-0001","-87.67976","34.8072",1728],
    				["Northeast Alabama Community College","Rainsville","AL","35986","-85.849296","34.495048",2998],
    				["Oakwood University","Huntsville","AL","35896","-86.661596","34.756663",2365],
    				["Alabama Southern Community College","Monroeville","AL","36460","-87.323941","31.48897",4066],
    				["Prince Institute of Professional Studies Inc","Montgomery","AL","36117","-86.161564","32.38201",3273],
    				["Reid State Technical College","Evergreen","AL","36401","-86.965527","31.45764",3766],
    				["Bishop State Community College","Mobile","AL","36603-5898","-88.056355","30.694054",4216],
    				["Samford University","Birmingham","AL","35229-2240","-86.790142","33.463236",2278],
    				["Selma University","Selma","AL","36701","-87.031607","32.419785",1589],
    				["Shelton State Community College","Tuscaloosa","AL","35405-8522","-87.557337","33.119706",2616],
    				["Snead State Community College","Boaz","AL","35957-0734","-86.168184","34.200609",3979],
    				["University of South Alabama","Mobile","AL","36688-0002","-88.174087","30.696578",1332],
    				["Spring Hill College","Mobile","AL","36608-1791","-88.148412","30.685751",3818],
    				["Southeastern Bible College","Birmingham","AL","35224-2083","-86.764053","33.364978",3362],
    				["Stillman College","Tuscaloosa","AL","35403","-87.582864","33.200716",1893],
    				["Talladega College","Talladega","AL","35160","-86.112036","33.433069",1750],
    				["H Councill Trenholm State Technical College","Montgomery","AL","36108-3199","-86.344604","32.34991",1491],
    				["Troy University","Troy","AL","36082-0001","-85.95035","31.7969",3185],
    				["Tuskegee University","Tuskegee","AL","36088-1920","-85.71794","32.41666",1529],
    				["United States Sports Academy","Daphne","AL","36526-7055","-87.91202","30.64004",1512],
    				["Bevill State Community College","Jasper","AL","35501","-87.265034","33.835785",4614],
    				["University of Alaska Anchorage","Anchorage","AK","99508","-149.826779","61.18824",3833],
    				["Alaska Bible College","Glennallen","AK","99588","-145.52624","62.11296",1397],
    				["University of Alaska Fairbanks","Fairbanks","AK","99775-7500","-147.82475","64.857053",2667],
    				["University of Alaska Southeast","Juneau","AK","99801-8697","-134.639195","58.381976",4632],
    				["Alaska Pacific University","Anchorage","AK","99508","-149.814307","61.189535",2294],
    				["AVTEC-Alaska's Institute of Technology","Seward","AK","99664-0889","-149.443826","60.110502",3874],
    				["Charter College-Anchorage","Anchorage","AK","99508","-149.83999","61.195436",2247],
    				["Prince William Sound Community College","Valdez","AK","99686-0097","-146.357096","61.133085",3495],
    				["Career Academy","Anchorage","AK","99507-1033","-149.855683","61.180849",2056],
    				["University of Alaska System of Higher Education","Fairbanks","AK","99775-5000","-147.847787","64.858009",2332],
    				["Everest College-Phoenix","Phoenix","AZ","85021-1641","-112.113531","33.580955",2407],
    				["Collins College","Phoenix","AZ","85040","-111.98646","33.40334",4469],
    				["Empire Beauty School-Paradise Valley","Phoenix","AZ","85032","-111.978446","33.602489",2132],
    				["Empire Beauty School-Tucson","Tucson","AZ","85716","-110.927873","32.235959",2653],
    				["Thunderbird School of Global Management","Glendale","AZ","85306-6000","-112.182574","33.622947",4777],
    				["American Indian College of the Assemblies of God Inc","Phoenix","AZ","85021","-112.091236","33.577578",4705],
    				["American Institute of Technology","Phoenix","AZ","85043-4729","-112.175284","33.442432",1305],
    				["Carrington College-Phoenix","Phoenix","AZ","85051-4063","-112.116921","33.561821",1494],
    				["Carrington College-Mesa","Mesa","AZ","85210","-111.845197","33.393316",2168],
    				["Carrington College-Tucson","Tucson","AZ","85705-5885","-110.978011","32.270954",1051],
    				["College America-Flagstaff","Flagstaff","AZ","86004","-111.606672","35.209765",1494],
    				["Arizona Academy of Beauty-East","Tucson","AZ","85712","-110.871281","32.236258",3777],
    				["Arizona Automotive Institute","Glendale","AZ","85301-3579","-112.15781","33.536413",1284],
    				["Brookline College-Phoenix","Phoenix","AZ","85021","-112.112382","33.56756",2278],
    				["Arizona State University","Tempe","AZ","85287","-111.932128","33.417515",3864],
    				["Arizona Western College","Yuma","AZ","85365-8834","-114.49618","32.69022",3350],
    				["University of Arizona","Tucson","AZ","85721-0066","-110.950875","32.232112",2691],
    				["The Art Center Design College-Tucson","Tucson","AZ","85716","-110.926828","32.252507",3125],
    				["Brillare Hairdressing Academy","Scottsdale","AZ","85251","-111.925323","33.50225",4149],
    				["Central Arizona College","Coolidge","AZ","85128-9030","-111.652297","32.95582",1046],
    				["Brown Mackie College-Tucson","Tucson","AZ","85712","-110.895053","32.236286",4869],
    				["Charles of Italy Beauty College","Lake Havasu City","AZ","86403","-114.328115","34.475229",1848],
    				["Cochise College","Douglas","AZ","85607-9724","-109.668765","31.361359",2800],
    				["Empire Beauty School-Flagstaff","Flagstaff","AZ","86004","-111.626367","35.195723",1166],
    				["Empire Beauty School-Chandler","Chandler","AZ","85224","-111.859237","33.349019",4161],
    				["Cortiva Institute-Tucson","Tucson","AZ","85710","-110.856548","32.220975",1571],
    				["DeVry University-Arizona","Phoenix","AZ","85021-2995","-112.104979","33.567573",3286],
    				["Avalon School of Cosmetology","Mesa","AZ","85210","-111.859667","33.376506",3735],
    				["Eastern Arizona College","Thatcher","AZ","85552-0769","-109.763017","32.84242",4068],
    				["Embry Riddle Aeronautical University-Prescott","Prescott","AZ","86301-3720","-112.445315","34.615181",4999],
    				["Frank Lloyd Wright School of Architecture","Scottsdale","AZ","85261","-111.846477","33.60715",3017],
    				["Glendale Community College","Glendale","AZ","85302","-112.188466","33.567524",4680],
    				["Grand Canyon University","Phoenix","AZ","85017","-112.129876","33.509446",2861],
    				["Anthem College-Phoenix","Phoenix","AZ","85014","-112.050333","33.4947",2422],
    				["International Academy of Hair Design","Chandler","AZ","85225-7198","-111.841802","33.354361",2166],
    				["Lamson College","Tempe","AZ","85284","-111.95313","33.349029",3999],
    				["Kaplan College-Phoenix","Phoenix","AZ","85029","-112.117258","33.609028",4134],
    				["Maricopa Beauty College LLC","Avondale","AZ","85323","-112.355232","33.435281",1851],
    				["Maricopa Community College System Office","Tempe","AZ","85281-6942","-111.97543","33.413592",3810],
    				["GateWay Community College","Phoenix","AZ","85034","-111.995403","33.449261",4773],
    				["Mesa Community College","Mesa","AZ","85202","-111.871413","33.392945",3127],
    				["ITT Technical Institute-Tucson","Tucson","AZ","85704-5829","-110.997501","32.297261",3034],
    				["ITT Technical Institute-Tempe","Tempe","AZ","85282","-111.969736","33.380254",3809],
    				["Mohave Community College","Kingman","AZ","86409-1238","-114.022914","35.268508",3406],
    				["Universal Technical Institute-Motorcycle Mechanics Institute Division","Phoenix","AZ","85027","-112.121476","33.683844",4897],
    				["Dine College","Tsaile","AZ","86556","-109.21009","36.301684",3762],
    				["Northern Arizona University","Flagstaff","AZ","86011-4132","-111.65582","35.19398",4914],
    				["Northland Pioneer College","Holbrook","AZ","86025-0610","-110.132719","34.936766",4704],
    				["Ottawa University-Phoenix","Phoenix","AZ","85021","-112.113493","33.577812",3628],
    				["Phoenix College","Phoenix","AZ","85013","-112.088334","33.480476",2413],
    				["Cortiva Institute-Scottsdale","Scottsdale","AZ","85257","-111.908192","33.46588",3013],
    				["University of Phoenix-Phoenix-Hohokam Campus","Phoenix","AZ","85040-1958","-111.979941","33.413016",2610],
    				["Pima Community College","Tucson","AZ","85709-5000","-110.985014","32.226881",1578],
    				["Pima Medical Institute-Tucson","Tucson","AZ","85716","-110.921331","32.250463",3029],
    				["Pima Medical Institute-Albuquerque","Albuquerque","NM","87110","-106.59439","35.105571",3032],
    				["Prescott College","Prescott","AZ","86301","-112.47627","34.544783",3826],
    				["Refrigeration School Inc","Phoenix","AZ","85034-1816","-111.989439","33.448254",3783],
    				["Rio Salado College","Tempe","AZ","85281","-111.974354","33.413592",3573],
    				["Roberto-Venn School of Luthiery","Phoenix","AZ","85040","-112.047076","33.410024",4832],
    				["Hair Academy of Safford","Safford","AZ","85546","-109.727248","32.834978",2949],
    				["Scottsdale Community College","Scottsdale","AZ","85256","-111.887308","33.509531",1087],
    				["South Mountain Community College","Phoenix","AZ","85042","-112.030256","33.382544",4861],
    				["Arizona Christian University","Phoenix","AZ","85032-7097","-112.026037","33.596721",1406],
    				["Tucson College","Tucson","AZ","85711","-110.883209","32.22176",3388],
    				["Universal Technical Institute of Arizona Inc","Avondale","AZ","85323","-112.289712","33.453494",3091],
    				["Western International University","Phoenix","AZ","85021","-112.116846","33.570542",4599],
    				["Empire Beauty School-NW Phoenix","Glendale","AZ","85051","-112.118476","33.538563",2291],
    				["Yavapai College","Prescott","AZ","86301","-112.457119","34.545361",2061],
    				["University of Arkansas at Little Rock","Little Rock","AR","72204","-92.341778","34.72685",1915],
    				["University of Arkansas for Medical Sciences","Little Rock","AR","72205-7199","-92.320992","34.75153",3987],
    				["ABC Beauty College Inc","Arkadelphia","AR","71923","-93.08187","34.12268",3520],
    				["Arkansas Baptist College","Little Rock","AR","72202-6099","-92.289393","34.735262",4439],
    				["Arkansas Beauty School","Little Rock","AR","72209","-92.334962","34.668785",2799],
    				["Arkansas Beauty College","Russellville","AR","72801","-93.135284","35.278587",1796],
    				["Lyon College","Batesville","AR","72501","-91.628158","35.77897",2139],
    				["Arkansas College of Barbering and Hair Design","North Little Rock","AR","72114","-92.266583","34.754023",2663],
    				["Arthur's Beauty College Inc-Fort Smith","Fort Smith","AR","72901-3342","-94.410982","35.380232",2640],
    				["University of Arkansas","Fayetteville","AR","72701","-94.17569","36.0671",4179],
    				["University of Arkansas at Pine Bluff","Pine Bluff","AR","71601","-92.019062","34.242231",1514],
    				["Arkansas State University-Beebe","Beebe","AR","72012-1000","-91.894579","35.070224",2129],
    				["Arkansas State University-Main Campus","Jonesboro","AR","72401","-90.680478","35.842779",3894],
    				["Arkansas Tech University","Russellville","AR","72801-2222","-93.134649","35.293505",2507],
    				["University of Arkansas at Monticello","Monticello","AR","71656","-91.80068","33.59223",3167],
    				["Arthur's Beauty College Inc","Jacksonville","AR","72076","-92.103665","34.891119",1710],
    				["Baptist Health Schools-Little Rock","Little Rock","AR","72210-2820","-92.40547","34.712269",1898],
    				["Bee Jays Academy","Little Rock","AR","72212","-92.405875","34.769604",1524],
    				["Black River Technical College","Pocahontas","AR","72455","-90.913157","36.237882",2736],
    				["University of Central Arkansas","Conway","AR","72035-0001","-92.454235","35.079315",3544],
    				["Central Baptist College","Conway","AR","72034","-92.509599","35.089094",4298],
    				["Cossatot Community College of the University of Arkansas","De Queen","AR","71832","-94.366883","34.044332",4619],
    				["Crowley's Ridge College","Paragould","AR","72450","-90.58468","36.066294",1840],
    				["Crowleys Ridge Technical Institute","Forrest City","AR","72335-0925","-90.77586","35.02685",2152],
    				["De Luxe Beauty School","Pine Bluff","AR","71603-1666","-92.018492","34.203384",1494],
    				["East Arkansas Community College","Forrest City","AR","72335","-90.775976","35.028127",3759],
    				["Eastern College of Health Vocations-Little Rock","Little Rock","AR","72205","-92.341312","34.751221",2272],
    				["Imagine-Paul Mitchell Partner School","North Little Rock","AR","72117","-92.22215","34.789458",2829],
    				["National Park Community College","Hot Springs","AR","71913","-93.119307","34.513294",3940],
    				["University of Arkansas Community College-Batesville","Batesville","AR","72503-3350","-91.602593","35.791214",4750],
    				["Harding University","Searcy","AR","72143","-91.728772","35.249646",2816],
    				["Henderson State University","Arkadelphia","AR","71999-0001","-93.059794","34.125583",3026],
    				["Hendrix College","Conway","AR","72032-3080","-92.444187","35.100058",3637],
    				["Hot Springs Beauty College","Hot Springs","AR","71901","-93.038379","34.496247",4249],
    				["Jefferson Regional Medical Center School of Nursing","Pine Bluff","AR","71603","-92.018188","34.189017",2779],
    				["John Brown University","Siloam Springs","AR","72761","-94.557506","36.187187",3552]
    	    	]
    	    },{
    	    	label : "Country Populations",
    	    	dimensions : 1,
    	    	data :[
    				["Country","1960","1970","1980","1990","2000","2010"],
    				["Afghanistan","9671046","11964906","15303189.5","19023678","25950815.5","34385000"],
    				["Albania","1610565","2135599","2671300","3289483","3071856","3205000"],
    				["Algeria","10799997","13746185","18811199","25299182","30533827","35468000"],
    				["American Samoa","20041","27288","32526","47052","57625","68420"],
    				["Andorra","13377","24364","37328","52773","64634","84864"],
    				["Angola","4963068","5926333","7638420","10335052","13926373","19082000"],
    				["Antigua and Barbuda","54657","65587","70228","62202","77656","88000"],
    				["Arab World","96388069","126316205","172463471.9","228934760.9","285376280.3","357868000"],
    				["Argentina","20625451","23983358","28131040","32642442","36930709","40412000"],
    				["Armenia","1867396","2518408","3096298","3544695","3076098","3092000"],
    				["Aruba","54209","59066","60099","62147","90271","108000"],
    				["Australia","10276477","12507000","14692000","17065100","19153000","22299000"],
    				["Austria","7047539","7467086","7549433","7677850","8011566","8390000"],
    				["Azerbaijan","3894492","5171999","6166000","7159000","8048600","9054000"],
    				["Bahamas The","109527","169367","210600","256128","297651","343000"],
    				["Bahrain","161825","211878","357957","492891","638193","1262000"],
    				["Bangladesh","50101943","66881158","80624423","105256026","129592275","148692000"],
    				["Barbados","230831","238593","248796","259501","267511","274000"],
    				["Belarus","8198000","9040000","9643000","10189000","10005000","9490000"],
    				["Belgium","9153489","9655549","9859242","9967379","10251250","10896000"],
    				["Belize","91046","119972","146000","189000","249800","345000"],
    				["Benin","2419644","2849508","3610578","4773137","6517810","8850000"],
    				["Bermuda","44400","55000","54000","60500","62131","64600"],
    				["Bhutan","225993","301879","430633","558500","571262","726000"],
    				["Bolivia","3354895","4216572","5352649","6658462","8307248","9929000"],
    				["Bosnia and Herzegovina","3180020","3564389","3913536","4308197","3693698","3760000"],
    				["Botswana","523997","692959","996211","1382371","1757925","2007000"],
    				["Brazil","72758801","96078304","121711864","149650206","174425387","194946000"],
    				["Brunei Darussalam","79846","125088","189300","252125","327036","399000"],
    				["Bulgaria","7867374","8489574","8861535","8718289","8170172","7534000"],
    				["Burkina Faso","4881947","5807492","7212088","9323996","12294012","16468000"],
    				["Burundi","2940498","3513499","4129997","5601720","6374347","8382000"],
    				["Cambodia","5433306","6937996","6505693","9531928","12446949","14139000"],
    				["Cameroon","5409083","6841763","9109727","12180819","15678269","19599000"],
    				["Canada","17909009","21324000","24593000","27791000","30769700","34126000"],
    				["Cape Verde","210933","274282","300047","348165","437238","496000"],
    				["Caribbean small states","4174705","4925446","5454027","5954846","6453378.551","6880000"],
    				["Cayman Islands","8092","9545","16861","26048","40195","56230"],
    				["Central African Republic","1503509","1828709","2273630","2934777","3701607","4401000"],
    				["Chad","2954088","3655905","4554089","6011224","8222327","11227000"],
    				["Channel Islands","109396","121126","128085","140137","145330","153352"],
    				["Chile","7651579","9577572","11178817","13187821","15419820","17113688"],
    				["China","667070000","818315000","981235000","1135185000","1262645000","1338300000"],
    				["Colombia","16004714","21329811","26874906","33203321","39764166","46295000"],
    				["Comoros","193052","238032","328861","437876","562469","735000"],
    				["Dem. Rep. Congo","15367539","20267009","27018690","36406226","49626200","65965000"],
    				["Costa Rica","1334004","1820379","2343345","3070240","3919180","4659000"],
    				["Cote d'Ivoire","3638385","5416416","8500985","12517730","16581653","19738000"],
    				["Croatia","4140000","4411000","4588000","4780000","4426000","4418000"],
    				["Cuba","7133582","8701886","9812223","10570328","11104313","11258000"],
    				["Curacao","","","","","133860.2201","142668.3993"],
    				["Cyprus","572997","613735","685510","766663","943294","1103000"],
    				["Czech Republic","9602006","9858071","10304193","10333355","10272322","10520000"],
    				["Denmark","4579603","4928757","5123027","5140939","5339616","5547000"],
    				["Djibouti","84877","161622","340133","562290","731930","889000"],
    				["Dominica","60015","71076","75312","70926","69672","68000"],
    				["Dominican Republic","3308941","4511577","5794074","7194666","8591967","9927000"],
    				["East Asia & Pacific (all income levels)","1045059513","1291044940","1559593050","1821479249","2044996322","2201536674"],
    				["East Asia & Pacific (developing only)","899015570","1118212323","1360910455","1604413745","1813796742","1961558757"],
    				["Ecuador","4439206","5972464","7957811","10260587","12345023","14465000"],
    				["Egypt, Arab Rep.","27903093","35923283","44952497","56843275","67648419","81121000"],
    				["El Salvador","2773095","3736311","4656263","5332842","5940305","6193000"],
    				["Equatorial Guinea","252115","290907","220582","373887","520380","700000"],
    				["Eritrea","1423599","1847000","2468902","3158295","3667576","5254000"],
    				["Estonia","1215650","1362295","1477219","1569174","1369515","1340000"],
    				["Ethiopia","22553350","28959382","35426282","48333261","65577897","82950000"],
    				["Euro area","260300607","281804083","296156805","304792347","315000148","331766000"],
    				["Europe & Central Asia (all income levels)","667971177","738366488","793913835.2","842442884","862063708.6","890424544"],
    				["Europe & Central Asia (developing only)","280771140","320321897","356092512.2","391770177","398510208.6","405204000"],
    				["European Union","405162097","437537997","459523135","472838945","483527101","502125000"],
    				["Faeroe Islands","34334","38547","42779","47558","45743","48708"],
    				["Fiji","393366","520555","635297","728390","811718","860000"],
    				["Finland","4429634","4606307","4779535","4986431","5176209","5364000"],
    				["France","46613691","51919493","55111030","58183174","60762169","64895000"],
    				["French Polynesia","79335","110872","151098","195383","237638","271000"],
    				["Gabon","485732","529526","682641","929044","1235274","1505000"],
    				["Gambia, The","372625","458663","629786","966151","1297084","1729000"],
    				["Georgia","3645600","3967800","4467700","4802000","4418300","4452000"],
    				["Germany","72814900","78169289","78288576","79433029","82211508","81777000"],
    				["Ghana","6742107","8681818","10922708","14793415","19165490","24392000"],
    				["Gibraltar","21518","24654","26565","26830","27348","29244"],
    				["Greece","8331725","8792806","9642505","10156902","10917482","11316000"],
    				["Greenland","32500","46400","50200","55600","56200","56534"],
    				["Grenada","89844","94393","88936","96200","101522","104000"],
    				["Guam","67436","85459","106572","133914","155147","179000"],
    				["Guatemala","4158956","5447687","7036484","8923131","11237101","14389000"],
    				["Guinea","3540756","4153653","4406831","5759374","8344486","9982000"],
    				["Guinea-Bissau","593289","602916","834611","1016695","1240655","1515000"],
    				["Guyana","560184","720738","776856","724931","733101","755000"],
    				["Haiti","3867502","4709644","5687812","7124877","8645371","9993000"],
    				["Heavily indebted poor countries (HIPC)","169626033","217798342","284545627.5","374575530","491037247.5","635663000"],
    				["High income","743366359","832920800","911679360","978972684","1049573306","1127437399"],
    				["High income: nonOECD","30275747","39331935","51147304.98","65330767","75790192.62","94204398.86"],
    				["High income: OECD","713090612","793588865","860532055","913641917","973783113","1033233000"],
    				["Honduras","1999530","2688208","3627640","4889311","6218151","7600000"],
    				["Hong Kong SAR, China","3075605","3959000","5063100","5704500","6665000","7068000"],
    				["Hungary","9983967","10337910","10711122","10373988","10210971","10000000"],
    				["Iceland","175574","204438","228138","254826","281205","318000"],
    				["India","447844159","553873890","700058589","873785449","1053898107","1224615000"],
    				["Indonesia","91946612","118361740","150820044","184345939","213395411","239870000"],
    				["Iran, Islamic Rep.","21999103","28662011","38576541","54870583","65342319","73973000"],
    				["Iraq","7379922","10021785","13774183","18194212.5","24313640.5","32031000"],
    				["Ireland","2828600","2957250","3412800","3513974","3805174","4475000"],
    				["Isle of Man","48445","56717","65112","70313","76803","82869"],
    				["Israel","2114020","2974000","3878000","4660000","6289000","7624000"],
    				["Italy","50199700","53821850","56433883","56719240","56942108","60483000"],
    				["Jamaica","1629003","1869000","2133000","2390000","2589388.551","2702000"],
    				["Japan","92500572","104345000","116782000","123537000","126870000","127451000"],
    				["Jordan","844000","1508000","2181000","3170000","4797500","6047000"],
    				["Kazakhstan","9995997","13109992","14898332.25","16348000","14883626","16323000"],
    				["Kenya","8105435","11252318","16267558","23447177","31253701","40513000"],
    				["Kiribati","40700","48900","58100","71845","84010","100000"],
    				["Korea, Dem. Rep.","10946479","14246772","17239340","20143212","22894095","24346000"],
    				["Korea, Rep.","25074152","31923000","38124000","42869000","47008000","48875000"],
    				["Kosovo","947000","1219000","1521000","1862000","1700000","1815000"],
    				["Kuwait","263718","753142","1376963","2087687","1940786","2736000"],
    				["Kyrgyz Republic","2172500","2964499","3632000","4391100","4898300","5448000"],
    				["Lao PDR","2129968","2691207","3234555","4192414","5317060","6201000"],
    				["Latin America & Caribbean (all income levels)","219302838","285495714","361418206","442065667","520373971.6","589011025.9"],
    				["Latin America & Caribbean (developing only)","215658966","281259403","356485545","436563801","514251597","582551688"],
    				["Latvia","2120979","2359164","2511701","2663151","2372985","2239000"],
    				["Least developed countries: UN classification","243658168","312034802","394889167.5","516098379","665090990.5","835140827"],
    				["Lebanon","1907573","2464286","2794638","2948372","3742329","4227000"],
    				["Lesotho","851594","1033044","1309981","1639177","1963878","2171000"],
    				["Liberia","1115736","1439677","1922536","2127098","2847290","3994000"],
    				["Libya","1349004","1994000","3063000","4334459","5231189","6355000"],
    				["Liechtenstein","16561","21358","25213","28986","32853","36032"],
    				["Lithuania","2778550","3139689","3413202","3697838","3499536","3287000"],
    				["Low & middle income","2296977146","2858854567","3536642688","4317705677","5068232226","5767157445"],
    				["Low income","237682528","306839766","388131379.5","505093768","643692522.5","796342000"],
    				["Lower middle income","886026454","1110285504","1412662003","1776482425","2146677647","2518690865"],
    				["Luxembourg","313970","339171","364150","381850","436300","507000"],
    				["Macao SAR, China","171450","250995","246230","359709","431867","544000"],
    				["Macedonia, FYR","1391996","1567968","1794830","1909353","2009091","2060000"],
    				["Madagascar","5103652","6548922","8608964","11280625","15364272","20714000"],
    				["Malawi","3525246","4531280","6239898","9380892","11228756","14901000"],
    				["Malaysia","8160113","10909353","13832586","18208562","23414909","28401000"],
    				["Maldives","90050","115772","156626","219474","273236","316000"],
    				["Mali","5247877","6034022","7245598","8672868","11295324","15370000"],
    				["Malta","326550","302650","316645","354170","381363","416000"],
    				["Marshall Islands","14661","20397","30578","47288","52145","54038"],
    				["Mauritania","854167","1133539","1517817","1995548","2642743","3460000"],
    				["Mauritius","659351","826000","966000","1058775","1186873","1281000"],
    				["Mayotte","24055","36755","55016","92413","148753","204000"],
    				["Mexico","38418829","51868335","68776411","84306602","99959594","113423000"],
    				["Micronesia, Fed. Sts.","44536","61431","72962","96319","107103","111000"],
    				["Middle East & North Africa (all income levels)","105399493","138516550","186881524.9","253292671.9","312596988.3","382803000"],
    				["Middle East & North Africa (developing only)","97797510","127431176","168731325.9","225408451.9","277413759.3","331263000"],
    				["Middle income","2059294618","2552014801","3148511308","3812611909","4424539703","4970815445"],
    				["Moldova","2544000","3045000","3397000","3696000","3639588","3562000"],
    				["Monaco","22135","23689","26078","30896","35126","35407"],
    				["Mongolia","957044","1281535","1693122","2192553","2411369","2756000"],
    				["Montenegro","466674","518727","576069","608816","632606","632000"],
    				["Morocco","11625999","15309995","19566920","24781105","28793236","31951000"],
    				["Mozambique","7647298","9453385","12145501","13547076","18200656","23390000"],
    				["Myanmar","20957397","26164131","32864901","39268304","44957660","47963000"],
    				["Namibia","602545","780386","1012824","1414830","1895839","2283000"],
    				["Nepal","9740462","11917872","15045329","19081064","24400606","29959000"],
    				["Netherlands","11486631","13038526","14149800","14951510","15925513","16616000"],
    				["New Caledonia","79000","108000","143000","168000","213230","247000"],
    				["New Zealand","2372000","2820000","3113000","3448000","3857800","4368000"],
    				["Nicaragua","1772895","2398160","3242190","4120797","5073704","5789000"],
    				["Niger","3249965","4372957","5871030","7788198","10922421","15512000"],
    				["Nigeria","45926253","57357275","75543388","97552057","123688536","158423000"],
    				["North America","198624409","226431000","251872000","277474500","312994242","343539600"],
    				["Northern Mariana Islands","10070","13203","17048","43973","68432","60917"],
    				["Norway","3581239","3875763","4085620","4241473","4490967","4889000"],
    				["OECD members","787321599","890498968","984592499","1065266608","1152790389","1236521688"],
    				["Oman","557492","731703","1181337","1868055","2264163","2783000"],
    				["Other small states","6067959","7397680","9547478","12565115","15539576.55","18293000"],
    				["Pacific island small states","1361955","1746814","1990783","2423701","2781946","3345337"],
    				["Pakistan","45920204","59382651","80492664","111844679","144522192","173593000"],
    				["Palau","9638","11481","12197","15089","19172","20472"],
    				["Panama","1128378","1509822","1953029","2415926","2956126","3517000"],
    				["Papua New Guinea","1966961","2434698","3215339","4157654","5378824","6858000"],
    				["Paraguay","1905829","2482508","3194768","4243860","5343539","6454000"],
    				["Peru","9929439","13187182","17286832","21685537","25861887","29076000"],
    				["Philippines","26010295","35451392","47063923","61628668","77309965","93261000"],
    				["Poland","29637450","32664300","35574150","38110782","38453757","38184000"],
    				["Portugal","8857716","8680431","9766312","9983218","10225836","10638000"],
    				["Puerto Rico","2358000","2718000","3206000","3537000","3814413","3978000"],
    				["Qatar","47085","108401","221594","473722","590957","1759000"],
    				["Romania","18406905","20250398","22242653","23201835","22442971","21438000"],
    				["Russian Federation","119897000","130404000","139010000","148292000","146303000","141750000"],
    				["Rwanda","2771018","3748672","5178927","7109538","8098344","10624000"],
    				["Samoa","109917","142354","155016","161308","176549","184000"],
    				["San Marino","15392","19136","21398","24134","26967","31534"],
    				["Sao Tome and Principe","64251","73630","94688","116117","141010","165000"],
    				["Saudi Arabia","4041422","5771846","9801475","16139053","20045276","27448000"],
    				["Senegal","3047804","4096245","5414070","7241573","9505862","12434000"],
    				["Serbia","","","","7586000","7516346","7291000"],
    				["Seychelles","41700","53600","64400","70000","81131","87000"],
    				["Sierra Leone","2187240","2593123","3161751","3981567","4143115","5867000"],
    				["Singapore","1646000","2075000","2414000","3047000","4027900","5077000"],
    				["Sint Maarten (Dutch part)","","","","","30519.39646","37850.45822"],
    				["Slovak Republic","4068095","4538223","4979815","5299187","5388720","5430000"],
    				["Slovenia","1584720","1724891","1901315","1998161","1988925","2049000"],
    				["Small states","11604619","14069940","16992288","20943662","24774901.1","28518337"],
    				["Solomon Islands","118054","160256","229235","309527","408732","538000"],
    				["Somalia","2819246","3601206","6435589","6599249","7399033","9331000"],
    				["South Africa","17396000","22087000","27576000","35200000","44000000","49991000"],
    				["South Asia","573614262","716992711","907194224.5","1147105918","1397953578","1633146000"],
    				["Spain","30455000","33814531","37439035","38850435","40263216","46071000"],
    				["Sri Lanka","10020405","12554583","15082771","17337048","18745084","20860000"],
    				["St. Kitts and Nevis","51000","44900","44400","42025","44286","52000"],
    				["St. Lucia","86440","101400","115500","134100","155996","174000"],
    				["St. Martin (French part)","4279","5450","7580","30036","28384","30235"],
    				["St. Vincent and the Grenadines","80948","90465","100450","107449","107891","109000"],
    				["Sub-Saharan Africa (all income levels)","230371813","294927964","387449207","512817471","666826721.5","854134000"],
    				["Sub-Saharan Africa (developing only)","230119698","294637057","387228625","512443584","666306341.5","853434000"],
    				["Sudan","11561784","14765539","20070866","26494169","34187729","43552000"],
    				["Suriname","290000","372297","365749","406890","466846","525000"],
    				["Swaziland","349181","445735","603385","862947","1010786.549","1056000"],
    				["Sweden","7484656","8042801","8310531","8558835","8872109","9378000"],
    				["Switzerland","5327827","6180877","6319408","6715519","7184250","7826000"],
    				["Syrian Arab Republic","4566822","6368017","8906543","12324116","15988534","20447000"],
    				["Tajikistan","2082499","2941501","3952691","5303152","6172807","6879000"],
    				["Tanzania","10074485","13604523","18685789","25478979","34038161","44841000"],
    				["Thailand","27312399","36915397","47482643","57072058","63155029","69122000"],
    				["Timor-Leste","499676","604382","580707","743145","830089","1124000"],
    				["Togo","1577708","2097273","2666921","3665509","4793504","6028000"],
    				["Tonga","61601","84369","92999","95150","97935","104000"],
    				["Trinidad and Tobago","841210","967658","1078200","1215494","1292058","1341000"],
    				["Tunisia","4220701","5127000","6384000","8154400","9563500","10549000"],
    				["Turkey","28160579","35464196","44105216","54130268","63627862","72752000"],
    				["Turkmenistan","1593501","2188499","2861000","3668000","4501419","5042000"],
    				["Turks and Caicos Islands","5724","5632","7525","11549","18873","38354"],
    				["Tuvalu","6104","7296","8051","9004","9419","9827"],
    				["Uganda","6788219","9445932","12662131","17699717","24213120","33424000"],
    				["Ukraine","42783010","47316501","50043550","51892000","49175847.64","45871000"],
    				["United Arab Emirates","89871","231754","1016228","1808642","3033491","7512000"],
    				["United Kingdom","52400000","55663250","56314216","57247586","58892514","62232000"],
    				["United States","180671000","205052000","227225000","249623000","282162411","309349000"],
    				["Upper middle income","1173268164","1441729297","1735849305","2036129484","2277862056","2452124580"],
    				["Uruguay","2538095","2809117","2914683","3109122","3300847.408","3357000"],
    				["Uzbekistan","8558503","11972994","15951899","20510000","24650500","28228000"],
    				["Vanuatu","63702","85393","115641","146636","185074","240000"],
    				["Venezuela, RB","7562108","10680678","15036273","19750000","24311000","28834000"],
    				["Vietnam","34743000","42729000","53700000","66016700","77630900","86928000"],
    				["Virgin Islands (U.S.)","32000","63000","97000","103963","108639","110000"],
    				["West Bank and Gaza","","","","1978248.403","3004149.794","4152000"],
    				["World","3040343505","3691775367","4448322048","5296678361","6117805532","6894594844"],
    				["Yemen, Rep.","5116419","6144992","7945180","11948209","17723186","24053000"],
    				["Zambia","3044733","4138837","5775165","7860053","10201562","12927000"],
    				["Zimbabwe","3752373","5206229","7289463","10469202","12509477","12571000"]
    	    	]
    	    }
    	];
    	var that = this;
		sap.ui.commons.Panel.prototype.init.apply(this,arguments);
		this.mainMenu = new sap.ui.commons.Menu({});
		this.presetsMenu = new sap.ui.commons.Menu({});
		for(var i=0;i<this.presets.length;i++){
			var newPresetItem = new sap.ui.commons.MenuItem({
				text : this.presets[i].label
			});
			newPresetItem.attachSelect(function(index){
				return function(oControlEvent){
					this._data = this.presets[index].data;
					propertyPage.updateProperty("kfIndex",this.presets[index].dimensions);
					this.cleanseData();
					this.updateProps();
					this.fireValueChange();
				};				
			}(i),this);
			this.presetsMenu.addItem(newPresetItem);
		}
		this.toggleItem = new sap.ui.commons.MenuItem({
			text : "Switch to CSV View"
		});
		this.presetsItem = new sap.ui.commons.MenuItem({
			text : "Presets",
			submenu : this.presetsMenu
		});
		this.toggleItem.attachSelect(this.toggleView, this);
		this.mainMenu.addItem(this.toggleItem);
		this.mainMenu.addItem(this.presetsItem);
		this.addButton(new sap.ui.commons.MenuButton({ 
			text : "Options",
			menu : this.mainMenu
		}));
		this._content = new sap.ui.commons.layout.VerticalLayout({
			width : "100%"
		});
		this.table = new sap.ui.table.Table({
			selectionMode: sap.ui.table.SelectionMode.None,
			visibleRowCount : 10,
			navigationMode : sap.ui.table.NavigationMode.Scrollbar
		});
		this.rowMenu = new sap.ui.commons.Menu({});
		//this.table.attachRowSelectionChange(this.showRowMenu,this);
		this.dataContents = new sap.ui.commons.TextArea({
			value : this.data(),
			design : sap.ui.core.Design.Monospace,
			rows : 10,
			width : "100%",
			wrapping : sap.ui.core.Wrapping.Off
		});
		this.dataContents.attachChange(this.dataContentsChanged, this);
		this.updateProps();
		this._content.addContent(this.dataLayout);
		this._content.addContent(this.table);
		this.addContent(this._content);
    },
    updateProps : function(){
    	this.dataContents.setValue(this.getValue());	// String version
		this.updateTable(this._data);					// Array version	
    },
    dataContentsChanged : function(){try{
		// Step 1 - Translate from Text
		var d = this.dataContents.getValue();
		this._data = [];
		_dataString = d.replace(/~\|~/g,"\n");
		var sd = _dataString.split("\n");
		for(var i=0;i<sd.length;i++){
			this._data.push(sd[i].split(","));
		}
		this.cleanseData();		
		this.updateTable(this._data);
		this.fireValueChange();
		}catch(e){alert(e)};
	},
    /**
	 * Cleanse Data
	 */
	cleanseData : function(){
		// Step 1 - Find Max Columns
		var maxCols = 0;
		for(var i=0;i<this._data.length;i++) {
			if(this._data[i].length>maxCols) maxCols = this._data[i].length;
		}
		// Step 2 - Balance Columns
		for(var i=0;i<this._data.length;i++){
			while(this._data[i].length<maxCols){
				if(i==0){	// Header Row, give Column Name
					this._data[i].push("Column " + this._data[i].length);	
				}else{		// Measure (maybe make a null)
					var kfIndex = propertyPage.kfIndex();
					if(this._data[i].length < kfIndex){
						this._data[i].push("#");
					}else{
						this._data[i].push(0);
					}
					
				}
			}
		}
		// Step 3 - Validate Columns
		for(var i=0;i<this._data.length;i++){
			var row = this._data[i];
			for(var j=0;j<row.length;j++){
				var kfIndex = propertyPage.kfIndex();
				if(i>0 && j >= kfIndex) {
					row[j] = Number(row[j]);
					if(isNaN(row[j])) row[j] = 0;
				}
			}
		};
		// Step 4 - Update UI5 Table and notify Design Studio Runtime
	},
	/**
	 * Insert a Row
	 */
	insertRow : function(index,direction){
		alert(index);
		var m = this.table.getModel();
		var s = m.getJSON();
		var o = jQuery.parseJSON(s);
		var newRows = o.rows;
		var newHeaders = o.headers;
		var newData = [];
		newData.push(newHeaders);
		for(var r=0;r<newRows.length;r++){
			newData.push(newRows[r]);
		}
		newData.splice(index + direction + 1,0,[]);		// +1 to account for header
		this._data = newData;
		this.cleanseData();
		this.fireValueChange();
		this.updateProps();
	},
	/**
	 * Delete a Row
	 */
	deleteRow : function(index){
		var m = this.table.getModel();
		var s = m.getJSON();
		var o = jQuery.parseJSON(s);
		var newRows = o.rows;
		var newHeaders = o.headers;
		var newData = [];
		newData.push(newHeaders);
		for(var r=0;r<newRows.length;r++){
			newData.push(newRows[r]);
		}
		newData.splice(index + 1,1);		// +1 to account for header
		this._data = newData;
		this.cleanseData();
		this.fireValueChange();
		this.updateProps();
	},
	/**
	 * Splice in new column before
	 */
	insertColumn : function(index,direction){
		var m = this.table.getModel();
		var s = m.getJSON();
		var o = jQuery.parseJSON(s);
		var newRows = o.rows;
		var newHeaders = o.headers;
		newHeaders.splice(index + direction,0,"Column "+ (index + direction));
		var newData = [];
		newData.push(newHeaders);
		var newValue = "#";
		var dimensionAdded = false;
		var kfIndex = propertyPage.kfIndex();
		if(index+direction >= kfIndex) {
			newValue = 0;
		}else{
			dimensionAdded = true;
		}
		for(var r=0;r<newRows.length;r++){
			var row = newRows[r];
			row.splice(index + direction,0,newValue);
			newData.push(row);
		}
		this._data = newData;
		if(dimensionAdded){
			var kfIndex = propertyPage.kfIndex();
			kfIndex++;
			propertyPage.updateProperty("kfIndex",kfIndex);
		}
		this.fireValueChange();
		this.updateProps();
	},
	/**
	 * Delete a Column
	 */
	deleteColumn : function(index){
		var m = this.table.getModel();
		var s = m.getJSON();
		var o = jQuery.parseJSON(s);
		var newRows = o.rows;
		var newHeaders = o.headers;
		newHeaders.splice(index,1);
		var newData = [];
		newData.push(newHeaders);
		for(var r=0;r<newRows.length;r++){
			var row = newRows[r];
			row.splice(index,1);
			newData.push(row);
		}
		this._data = newData;
		var kfIndex = propertyPage.kfIndex();
		if(index < kfIndex) {
			kfIndex--;
			propertyPage.updateProperty("kfIndex",kfIndex);
		}
		this.fireValueChange();
		this.updateProps();
	},
	/**
	 * Rename a Column
	 */
	renameColumn : function(index,newLabel){
		var m = this.table.getModel();
		var s = m.getJSON();
		var o = jQuery.parseJSON(s);
		var newRows = o.rows;
		var newHeaders = o.headers;
		newHeaders[index] = newLabel;
		var newData = [];
		newData.push(newHeaders);
		for(var r=0;r<newRows.length;r++){
			newData.push(newRows[r]);
		}
		this._data = newData;
		this.fireValueChange();
		this.updateProps();
	},
	/**
	 * Change a field
	 */
	changeField : function(){
		var m = this.table.getModel();
		var s = m.getJSON();
		var o = jQuery.parseJSON(s);
		var newRows = o.rows;
		var newHeaders = o.headers;
		var newData = [];
		newData.push(newHeaders);
		for(var r=0;r<newRows.length;r++){
			newData.push(newRows[r]);
		}
		this._data = newData;
		this.fireValueChange();
		this.updateProps();
	},
	/**
	 * Updates UI5 table
	 */
	updateTable : function(d){
		var rows = d;
		var fact = [];
		var headers = [];
		this.table.removeAllColumns();
		this.table.destroyRows();
		this.table.unbindRows();
		var headers = [];
		if(d.length==0){
			d.push([]);	// Header
		}
		if(d.length>0){
			var headers = d[0];
			var rowMenu = new sap.ui.commons.Menu({});
			var rowMenuButton = new sap.ui.commons.MenuButton({
				icon : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAIElEQVR42mNkoBAwAvH6ATeAYi8MAwNGY2EwGDDEYwEA8MUEK153B5IAAAAASUVORK5CYII=",
				menu : rowMenu
			});
			var uiCol = new sap.ui.table.Column({
				label : "",
				width : "50px",
				resizable : false,
				template : rowMenuButton.bindProperty("text","s")
			});
			var rowInsertBefore = new sap.ui.commons.MenuItem({
				text : "Insert Before",
				icon : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACZSURBVDhPY1yzZjMDKQCk4azxZCiPEDA+m8sEZRINaK+BLE+7u/tAeYTAzp1bBoOneZcx8s4BIQiXBYiBLoNwsINvDBMz4vJ7F0F4IA24PA039devXyDuRBAXpAEPAJoNUV0Z7QYk26fvwqvhKwPEJUDVQKUQMXyefpX2H4gYPkG5n2v/rzHbTDimQ075gqgPDGvcNjMwMAAAveg31dg0HpIAAAAASUVORK5CYII="
			});
			rowInsertBefore.attachSelect(function(){
				return function(oControlEvent){
					var model = oControlEvent.getSource().getModel();
					var path = oControlEvent.getSource().getBindingContext().getPath("rows");
					var arrPath = path.split("/");
					var index = parseInt(arrPath[2]);
					this.insertRow(index,0);
				};
			}(),this);
			var rowInsertAfter = new sap.ui.commons.MenuItem({
				text : "Insert After",
				icon : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACRSURBVDhPY1yzZjMDKQCkwd3dB8ojBHbu3MIEZRINaK9hZHiadxkj7xwQgnBZgBjoMggHO/jGMDEjLr93EYQH0nDWeDKEgwbaN+yCMH79+gUkeSeCLAFpwAOAZkNUV0a7Acn26bvwavjKAHEJUDVQKUQMn6eB6kAGf4JxM93WmG0mHNMhp3xB1AeGNW6bGRgYAHnXNiTeec8GAAAAAElFTkSuQmCC"
			});
			rowInsertAfter.attachSelect(function(index){
				return function(oControlEvent){
					var model = oControlEvent.getSource().getModel();
					var path = oControlEvent.getSource().getBindingContext().getPath("rows");
			        var arrPath = path.split("/");
			        var index = parseInt(arrPath[2]);
					this.insertRow(index,1);
				};
			}(i),this);
			var rowDelete = new sap.ui.commons.MenuItem({
				text : "Delete",
				icon : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAA3SURBVDhPY1yzZjMDKQCkwd3dB8ojBHbu3MIEZRINaK+BLE87rlgK5REC+yOih4unR1hMMzAAADMQF2dN9VQWAAAAAElFTkSuQmCC"
			});
			rowDelete.attachSelect(function(index){
				return function(oControlEvent){
					var model = oControlEvent.getSource().getModel();
					var path = oControlEvent.getSource().getBindingContext().getPath("rows");
			        var arrPath = path.split("/");
			        var index = parseInt(arrPath[2]);
					this.deleteRow(index);
				};
			}(i),this);
			rowMenu.addItem(rowInsertBefore);
			rowMenu.addItem(rowInsertAfter);
			rowMenu.addItem(rowDelete);

			this.table.addColumn(uiCol);
			for(var i=0;i<headers.length;i++){
				var field = new sap.ui.commons.TextField();
				field.attachChange(this.changeField,this);
				var uiCol = new sap.ui.table.Column({
					label: new sap.ui.commons.Label({text : headers[i]}),
					//width: "40px",
					template: field.bindProperty("value", String(i)),
					sortProperty: i,
					filterProperty: i
				});
				// Column Menu
				var m = new sap.ui.commons.Menu({});
				var menuInsertBefore = new sap.ui.commons.MenuItem({
					text : "Insert Before",
					icon : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABMlBMVEXY2P//xV//y4qfn7Pf3/+VlZWTk5OHh4eFhYX/t1F/f3+ZmbN9fX3Z2f93d3ezgzugoLNxcXGR915vb2/g4P9tbW2N81r/sEpra2tpaWn/vVf/0Zl74Uh33UTT0//+/v7/tlCamrPa2v//w12zgjqhobMAkwAAkQAAjwAAjQAAiwAAiQAAhwAAhQAAgwAAgQAAfQD/vFb/woEAdQAAbQD/z47W1tbGxsbb2///wlz/yIfewqKiorPi4v//rkj/zo3V1f+WlpaUlJScnLP/tE7c3P/j4/+CgoL/rUd6enp0dHT/ulT/wH9wcHBubm5sbGxqampoaGiG7FOdnbP/s03d3f943kX/wFr////X1/8AegAAeAAAcgAAcACenrPe3v//skz/v1nl5f+zgDn/vn2YmLNbHszzAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAACXZwQWcAAAAQAAAAEABcxq3DAAAAt0lEQVQY02OIQAMMIMKRncOdi8eTz0sQJsCobBluk2TL4gsVYLUMT5RCFnCSMjT0BgkIQwXY+FWSk1UF4pz9YAKcCi4hqm4ioTABM1P7BHEBWxZXUbCAvJq6JpOdB7NIvIU/RIWGkLa0lVVcvCsvWEBdU0tMT9/AOliRO1UCJKApJBYkExZtpKjEEBkAEtDR1ZeJMo714WaIdJCEmGEgG5OSkpIa6SAHFTCONTEH+cxPIhDqDmQAAAIXQfP5Hsc9AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDEyLTAyLTI2VDEyOjMwOjAwKzAxOjAwez08xAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxMi0wMi0yNlQxMjozMDowMCswMTowMApghHgAAAAASUVORK5CYII="
				});
				menuInsertBefore.attachSelect(function(index){
					return function(oControlEvent){
						this.insertColumn(index, 0);
					};
				}(i),this);
				
				var menuDelete = new sap.ui.commons.MenuItem({
					text : "Delete",
					icon : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAA3NCSVQICAjb4U/gAAAAn1BMVEX////4YmT/dnnyTE//dnn9bnH6am34YmT3XWD2WVv2VVjsOj3oMDLlJyrjICL2VVjzUVTwR0ruPT/iHB72WVvwR0rzUVT/h4r/gob/foH/eXv/dnn/cnT9bnH/bG76am3/Zmb6ZGf4YmT3XWD/WFv2WVv/VFf2VVj0TVDyTE/2SkzwR0rvREfuQUPuPT/sOj3rNDboMDLnLTDlJyrjICIhCpwnAAAANXRSTlMAESIiMzMzMzMzMzMzMzNERERERHd3qv///////////////////////////////////////0mgXpwAAAAJcEhZcwAAHngAAB54AcurAx8AAAAYdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3Jrc0+zH04AAACVSURBVBiVbczXFoIwDAbguHGi4mqbWugQZInj/Z9NSuXAhblJvuTkB+jV4NeHY9e9g+/M2KSxFKdRY0JwWltxoo72gvRMxcxTgqrM/Qp2QWmdt+kRJ5SyzgCGao09zw3TN8yWnSNEfo3LVWdTPJIwqdbWCyN5XABUeZi+NvViG0trgHeRPgM77O6l+/04A+zb9AD+1Bf6lg3jQQJJTgAAAABJRU5ErkJggg=="
				});
				menuDelete.attachSelect(function(index){
					return function(oControlEvent){
						this.deleteColumn(index);
					};
				}(i),this);
				var menuInsertAfter = new sap.ui.commons.MenuItem({
					text : "Insert After",
					icon : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABLFBMVEXz8///xV/f3/+VlZX/0pqTk5ORkZGPj4+NjY2trbPt7f+Hh4eFhYX/t1F/f3//yZN9fX2zgzugoLNxcXGR915vb2/7+/+N81r/sEqnp7P/vVf/0Zl74Uh33UT+/v7/tlDizLH/w12zgjqhobP8/P8AkwAAkQAAjwAAjQAAiwAAiQAAhwAAhQAAgwAAgQCoqLMAfQD/vFYAdQAAbQD/0Jjv7//IyMj/wlyiorPi4v//rkjw8P+WlpaUlJScnLOSkpL/tE6QkJD39/+Ojo6Kior/1Z2CgoLq6v//ulRwcHD/zpZubm7/zJaG7FP/s03/x4943kX/wFqkpLP/1Jz///+rq7Py8v8AegAAeAAAcgAAcACenrP5+f//v1mlpbPl5f//05usrLOzgDn/ypSdwyaSAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAACXZwQWcAAAAQAAAAEABcxq3DAAAAu0lEQVQY02MIQQMMISE2rI4cLtw8bnzCMIEQlRhORkXzQE+oALOKWAyneWCsFEzANibGKVHK0NBDFCrAysmZGCqolJTkDRNgYAjT55V38IMJ2Ftbm0o6+LkGm0EF2Li4uOIkrBJU1TSgAu7u7kEs0ibqIlpyYAFHCwsLZQU1DU1xXT0DkAB7fHy8kJeGiLivTEAEWMDS0jLaR1tHTybcKAok4MzExGSXzO9vIBsJMRTiMwEzoyhjiAAqAACTGz6DRU9JuwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxMi0wMi0yNlQxMjozMDowMCswMTowMHs9PMQAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTItMDItMjZUMTI6MzA6MDArMDE6MDAKYIR4AAAAAElFTkSuQmCC"
				});
				menuInsertAfter.attachSelect(function(index){
					return function(oControlEvent){
						this.insertColumn(index, 1);
					};
				}(i),this);
			
				var menuRename = new sap.ui.commons.MenuTextFieldItem({
					label : "Rename:",
					icon : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAZ9JREFUeNqkUzlLA0EU/mZ2ks1hQAQtRDyCFlYpFDvBSkjjj1DwiqCVB9Y2VhYKYm1jIQjmB2jphX8hhY3gUQjZze7OPF92syroisGBZR773ne8mTeCiPCfJZIS6yvzZIQFwyUSBEkau/tHoh3ysea3UZmjOP6pSA1vn5HrawTmsxViVRKsa6XgP5+ge7N6K7QPQU0/UZ3kuK84COUw+HqrjOZOXzuSAlYqg53KMa44H3guyJgPiYwEFi+eoHxt0NuZxctDDRaDhGANFjG8w9ioM3GH8wTXdWBiAi7oLxbhBo9Q8S1MV9+QVRKSSQz/c7XAzWwPNLeWKxQglGoRsM8WxnBOxY5tC0wAdgEGRSRQdgjK57JQyoLWOu7u8xDjMaj7JmSUIgI7Ue2HbTud/n4FTY04vl8utT9E7ERa+H0SbbaetFLcixoYGUL5tIaGF4RUIZ1UIJWGSGcxms9g6vwV5DkQgcc9BTyZEbjuNaBuVicnyG+YJJXS0sLt5UzXeNtvYa2ySEaqVgkfLivvHRyKPxMkzP7dN4L/Pud3AQYAKoqz1m0k8iEAAAAASUVORK5CYII=",
					value : headers[i]
				});
				menuRename.attachSelect(function(index){
					return function(oControlEvent){
						this.renameColumn(index, oControlEvent.getSource().getValue());
					};
				}(i),this);

				m.addItem(menuInsertBefore);
				m.addItem(menuInsertAfter);
				m.addItem(menuRename);
				m.addItem(menuDelete);			
				uiCol.setMenu(m);
				this.table.addColumn(uiCol)
			}
			// End of Column Construction
			var dataModel = new sap.ui.model.json.JSONModel();
			var rows = [];
			for(var i=1;i<d.length;i++) {
				rows.push(d[i].slice(0));		// Shallow Copy
			}
			dataModel.setData({
				rows: rows,
				headers : headers
			});
			
			this.table.setModel(dataModel);
			this.table.bindRows("/rows");
		}
	},
	toggleView : function(oControlEvent){
		this._content.removeAllContent();
		if(this.toggleItem.getText() == "Switch to Table View"){
			this.toggleItem.setText("Switch to CSV View");
			this._content.addContent(this.table);
		}else{
			this.toggleItem.setText("Switch to Table View");
			this._content.addContent(this.dataContents);
		}
	},
	showRowMenu : function(oControlEvent){
		alert("!");
	}    
});
