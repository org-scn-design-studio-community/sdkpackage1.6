/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.suite.ui.commons.DateRangeSliderInternal");jQuery.sap.require("sap.suite.ui.commons.library");jQuery.sap.require("sap.ui.commons.RangeSlider");sap.ui.commons.RangeSlider.extend("sap.suite.ui.commons.DateRangeSliderInternal",{metadata:{library:"sap.suite.ui.commons",properties:{"showBubbles":{type:"boolean",group:"Misc",defaultValue:true},"pinGrip":{type:"boolean",group:"Misc",defaultValue:false},"pinGrip2":{type:"boolean",group:"Misc",defaultValue:false}},events:{"change":{},"liveChange":{}}}});sap.suite.ui.commons.DateRangeSliderInternal.M_EVENTS={'change':'change','liveChange':'liveChange'};jQuery.sap.require("sap.ui.commons.RangeSlider");jQuery.sap.require("jquery.sap.resources");jQuery.sap.require("sap.ui.core.format.DateFormat");jQuery.sap.require("sap.ui.core.ResizeHandler");jQuery.sap.require("sap.ui.commons.Label");jQuery.sap.require("sap.suite.ui.commons.util.DateUtils");(function(){var D=12;var a="d";var M="m";sap.suite.ui.commons.DateRangeSliderInternal.prototype.init=function(){this.setSmallStepWidth(1);this._sGranularity=a;this._oDateFormat=null;var m=new Date();this._dMinDate=sap.suite.ui.commons.util.DateUtils.incrementDateByIndex(m,-365);if(!this.getTotalUnits()){this.setTotalUnits(D);}this.setMin(0);this.setMax(365);this.setValue(0);this.setValue2(365);var t=(this.getLabels()&&this.getLabels().length>0);this._bUsingDefaultLabels=this.getStepLabels()&&!t;if(this._bUsingDefaultLabels){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(this);}if(this.getShowBubbles()){this._oBubble=new sap.ui.commons.Label({id:this.getId()+'-bubbleTxt'});this._oBubble2=new sap.ui.commons.Label({id:this.getId()+'-bubbleTxt2'});this._oBubble.addStyleClass("sapSuiteUiCommonsDateRangeSliderBubbleLblTxt");this._oBubble2.addStyleClass("sapSuiteUiCommonsDateRangeSliderBubbleLblTxt");this._oBubble.setText(this.getFormattedDate(this.getValueDate()));this._oBubble2.setText(this.getFormattedDate(this.getValue2Date()));}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setVertical=function(v){jQuery.sap.log.error("DateRangeSliderInternal.setVertical method is not yet supported!");};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setHeight=function(h){jQuery.sap.log.error("DateRangeSliderInternal.setHeight method is not yet supported!");};sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels=function(d){var r=[];var t=d.getTotalUnits();var s=(d.getMax()-d.getMin())/t;for(var i=0;i<=t;i++){var b=Math.round(parseFloat(d.getMin()+i*s));if(b>d.getMax()){b=d.getMax();}var T=null;if(d._sGranularity===a){T=sap.suite.ui.commons.util.DateUtils.incrementDateByIndex(d.getMinDate(),b);}else if(d._sGranularity===M){T=sap.suite.ui.commons.util.DateUtils.incrementMonthByIndex(d.getMinDate(),b);}r[i]=d.getFormattedDate(T);}d.setProperty("labels",r);return r;};sap.suite.ui.commons.DateRangeSliderInternal.repositionBubbles=function(d){var g=d.getId()+'-grip';var G=jQuery.sap.domById(g);var l=G.style.left;var L=l.substring(0,l.length-2);var i=parseInt(L,10);var s=d.getId()+'-grip2';var o=jQuery.sap.domById(s);var b=o.style.left;var c=b.substring(0,b.length-2);var e=parseInt(c,10);var B=d.getId()+'-bubble';var f=jQuery.sap.domById(B);var h=d.getId()+'-bubble2';var j=jQuery.sap.domById(h);var k=null,m=null;var n=f.style.left;if(n){k=n.substring(0,n.length-2);}var p=j.style.left;if(p){m=p.substring(0,p.length-2);}var w=jQuery(f).css("width");var W=parseInt(w,10);var q=41;if(((i+W)<e)||(!k&&!m)){f.style.left=(i-q)+"px";j.style.left=(e-q)+"px";}if(sap.ui.getCore().getConfiguration().getRTL()&&((e+W)<i)){f.style.left=(i-q)+"px";j.style.left=(e-q)+"px";}var v=d.getFormattedDate(d.getValueDate());var V=d.getFormattedDate(d.getValue2Date());d._oBubble.setText(v);d._oBubble2.setText(V);if(d.isActive()){d._oBubble.rerender();d._oBubble2.rerender();}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.changeGrip=function(n,N,g){sap.ui.commons.Slider.prototype.changeGrip.apply(this,arguments);if(!isNaN(n)){var d=Math.round(n);var t=null;if(this._sGranularity===a){t=sap.suite.ui.commons.util.DateUtils.incrementDateByIndex(this._dMinDate,d);}else if(this._sGranularity===M){t=sap.suite.ui.commons.util.DateUtils.incrementMonthByIndex(this._dMinDate,d);}g.title=this.getFormattedDate(t);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setAriaState=function(){var d=this.getFormattedDate(this.getValueDate());var b=this.getFormattedDate(this.getValue2Date());if(this.oMovingGrip===this.oGrip){this.oMovingGrip.setAttribute('aria-valuetext',d);this.oMovingGrip.setAttribute('aria-valuenow',this.getValue());this.oGrip2.setAttribute('aria-valuemin',d);}else{this.oMovingGrip.setAttribute('aria-valuetext',b);this.oMovingGrip.setAttribute('aria-valuenow',this.getValue2());this.oGrip.setAttribute('aria-valuemax',b);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.getFormattedDate=function(d){var f=null;switch(this._sGranularity){case(a):f=this._oDateFormat||sap.ui.core.format.DateFormat.getDateInstance({style:"medium"});break;case(M):f=this._oDateFormat||sap.ui.core.format.DateFormat.getDateInstance({pattern:'MMM YYYY'});break;}return f.format(d);};sap.suite.ui.commons.DateRangeSliderInternal.updateLabelBubbleToolTipValues=function(d){if(d._bUsingDefaultLabels){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(d);}if(d.getShowBubbles()){var v=d.getFormattedDate(d.getValueDate());var V=d.getFormattedDate(d.getValue2Date());d._oBubble.setText(v);d._oBubble2.setText(V);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.getDateFormat=function(){return this._oDateFormat;};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setDateFormat=function(d){if(d&&d instanceof sap.ui.core.format.DateFormat){this._oDateFormat=d;}else{this._oDateFormat=null;}sap.suite.ui.commons.DateRangeSliderInternal.updateLabelBubbleToolTipValues(this);};sap.suite.ui.commons.DateRangeSliderInternal.prototype.getDateRange=function(){var v=this.getValueDate();var V=this.getValue2Date();var c={valueDate:v,value2Date:V};return c;};sap.suite.ui.commons.DateRangeSliderInternal.prototype.handleFireChange=function(){if(this.getShowBubbles()){sap.suite.ui.commons.DateRangeSliderInternal.repositionBubbles(this);}var r=this.getDateRange();this.fireChange({value:r.valueDate,value2:r.value2Date});this.fireLiveChange({value:r.valueDate,value2:r.value2Date});};sap.suite.ui.commons.DateRangeSliderInternal.prototype.handleFireChangeWithoutLive=function(){if(this.getShowBubbles()){sap.suite.ui.commons.DateRangeSliderInternal.repositionBubbles(this);}var r=this.getDateRange();this.fireChange({value:r.valueDate,value2:r.value2Date});};sap.suite.ui.commons.DateRangeSliderInternal.prototype.fireLiveChangeForGrip=function(g,n,o){if(this.getShowBubbles()&&o!==n){sap.suite.ui.commons.DateRangeSliderInternal.repositionBubbles(this);}var r;if(g===this.oGrip){if(o!==n){r=this.getDateRange();this.fireLiveChange({value:r.valueDate,value2:r.value2Date});}}else if(g===this.oGrip2){if(o!==n){r=this.getDateRange();this.fireLiveChange({value:r.valueDate,value2:r.value2Date});}}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onAfterRendering=function(){sap.ui.commons.RangeSlider.prototype.onAfterRendering.apply(this);if(this.getShowBubbles()){sap.suite.ui.commons.DateRangeSliderInternal.repositionBubbles(this);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onresize=function(e){sap.ui.commons.RangeSlider.prototype.onresize.apply(this,arguments);if(this.getDomRef()){if(this.getShowBubbles()){sap.suite.ui.commons.DateRangeSliderInternal.repositionBubbles(this);}}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setStepLabels=function(s){this.setProperty("stepLabels",s);if(s===true){var t=(this.getLabels()&&this.getLabels().length>0);if(!t){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(this);this._bUsingDefaultLabels=true;}}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setLabels=function(l){this.setProperty("labels",l);var t=(this.getLabels()&&this.getLabels().length>0);if(this.getStepLabels()&&!t){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(this);this._bUsingDefaultLabels=true;}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setSmallStepWidth=function(s){this.setProperty("smallStepWidth",Math.round(s));};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setTotalUnits=function(t){this.setProperty("totalUnits",t);if(this._bUsingDefaultLabels){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(this);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.getMaxDate=function(){var m=null;switch(this._sGranularity){case(a):m=sap.suite.ui.commons.util.DateUtils.incrementDateByIndex(this._dMinDate,this.getMax());sap.suite.ui.commons.util.DateUtils.resetDateToEndOfDay(m);break;case(M):m=sap.suite.ui.commons.util.DateUtils.incrementMonthByIndex(this._dMinDate,this.getMax());sap.suite.ui.commons.util.DateUtils.resetDateToEndOfMonth(m);break;}return m;};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setMaxDate=function(m){var d=this.getMinDate();var v=this.getValueDate();var V=this.getValue2Date();var f=false;var n=0,N=0,i=0;switch(this._sGranularity){case(a):n=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(d,m);N=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(d,v);i=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(d,V);break;case(M):n=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(d,m);N=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(d,v);i=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(d,V);break;}f=N>n||i>n;N=N>n?n:N;i=i>n?n:i;this.setProperty('min',0,true);this.setProperty('max',n,true);this.setProperty('value',N,true);this.setProperty('value2',i,true);if(this._bUsingDefaultLabels){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(this);}if(f){var r=this.getDateRange();this.fireChange({value:r.valueDate,value2:r.value2Date});}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.getMinDate=function(){var m=new Date(this._dMinDate);switch(this._sGranularity){case(a):sap.suite.ui.commons.util.DateUtils.resetDateToStartOfDay(m);break;case(M):sap.suite.ui.commons.util.DateUtils.resetDateToStartOfMonth(m);break;}return m;};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setMinDate=function(m){var d=this.getMaxDate();var v=this.getValueDate();var V=this.getValue2Date();this._dMinDate=new Date(m);var f=false;var n=0,N=0,i=0;switch(this._sGranularity){case(a):n=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(m,d);N=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(m,v);i=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(m,V);break;case(M):n=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(m,d);N=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(m,v);i=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(m,V);break;}f=N<0||i<0;N=N<0?0:N;i=i<0?0:i;this.setProperty('min',0,true);this.setProperty('max',n,true);this.setProperty('value',N,true);this.setProperty('value2',i,true);if(this._bUsingDefaultLabels){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(this);}if(f){var r=this.getDateRange();this.fireChange({value:r.valueDate,value2:r.value2Date});}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.getValue2Date=function(){var v=null;switch(this._sGranularity){case(a):v=sap.suite.ui.commons.util.DateUtils.incrementDateByIndex(this._dMinDate,this.getValue2());sap.suite.ui.commons.util.DateUtils.resetDateToEndOfDay(v);break;case(M):v=sap.suite.ui.commons.util.DateUtils.incrementMonthByIndex(this._dMinDate,this.getValue2());sap.suite.ui.commons.util.DateUtils.resetDateToEndOfMonth(v);break;}return v;};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setValue2Date=function(v){var n=0;switch(this._sGranularity){case(a):n=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(this._dMinDate,v);break;case(M):n=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(this._dMinDate,v);break;}this.setProperty('value2',n,true);var r=this.getDateRange();this.fireChange({value:r.valueDate,value2:r.value2Date});};sap.suite.ui.commons.DateRangeSliderInternal.prototype.getValueDate=function(){var v=null;switch(this._sGranularity){case(a):v=sap.suite.ui.commons.util.DateUtils.incrementDateByIndex(this._dMinDate,this.getValue());sap.suite.ui.commons.util.DateUtils.resetDateToStartOfDay(v);break;case(M):v=sap.suite.ui.commons.util.DateUtils.incrementMonthByIndex(this._dMinDate,this.getValue());sap.suite.ui.commons.util.DateUtils.resetDateToStartOfMonth(v);break;}return v;};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setValueDate=function(v){var n=0;switch(this._sGranularity){case(a):n=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(this._dMinDate,v);break;case(M):n=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(this._dMinDate,v);break;}this.setProperty('value',n,true);var r=this.getDateRange();this.fireChange({value:r.valueDate,value2:r.value2Date});};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setDayGranularity=function(){var m=this.getMinDate();var v=this.getValueDate();var V=this.getValue2Date();var d=this.getMaxDate();var n=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(m,v);var N=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(m,V);var i=sap.suite.ui.commons.util.DateUtils.numberOfDaysApart(m,d);this.setProperty('min',0,true);this.setProperty('value',n,true);this.setProperty('value2',N,true);this.setProperty('max',i,true);this._sGranularity=a;if(this._bUsingDefaultLabels){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(this);}var r=this.getDateRange();this.fireChange({value:r.valueDate,value2:r.value2Date});};sap.suite.ui.commons.DateRangeSliderInternal.prototype.setMonthGranularity=function(){var m=this.getMinDate();var v=this.getValueDate();var V=this.getValue2Date();var d=this.getMaxDate();var n=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(m,v);var N=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(m,V);var i=sap.suite.ui.commons.util.DateUtils.numberOfMonthsApart(m,d);this.setProperty('min',0,true);this.setProperty('value',n,true);this.setProperty('value2',N,true);this.setProperty('max',i,true);this._sGranularity=M;sap.suite.ui.commons.util.DateUtils.resetDateToStartOfMonth(this._dMinDate);if(this._bUsingDefaultLabels){sap.suite.ui.commons.DateRangeSliderInternal.createRailLabels(this);}var r=this.getDateRange();this.fireChange({value:r.valueDate,value2:r.value2Date});};sap.suite.ui.commons.DateRangeSliderInternal.prototype.handleMove=function(e){if((this.oMovingGrip===this.oGrip2&&!this.getPinGrip2())||(this.oMovingGrip===this.oGrip&&!this.getPinGrip())){sap.ui.commons.RangeSlider.prototype.handleMove.apply(this,[e]);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onsapend=function(e){if((this.oMovingGrip===this.oGrip2&&!this.getPinGrip2())||(this.oMovingGrip===this.oGrip&&!this.getPinGrip())){sap.ui.commons.RangeSlider.prototype.onsapend.apply(this,[e]);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onsaphome=function(e){if((this.oMovingGrip===this.oGrip2&&!this.getPinGrip2())||(this.oMovingGrip===this.oGrip&&!this.getPinGrip())){sap.ui.commons.RangeSlider.prototype.onsaphome.apply(this,[e]);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onsaprightmodifiers=function(e){if((this.oMovingGrip===this.oGrip2&&!this.getPinGrip2())||(this.oMovingGrip===this.oGrip&&!this.getPinGrip())){sap.ui.commons.RangeSlider.prototype.onsaprightmodifiers.apply(this,[e]);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onsapleftmodifiers=function(e){if((this.oMovingGrip===this.oGrip2&&!this.getPinGrip2())||(this.oMovingGrip===this.oGrip&&!this.getPinGrip())){sap.ui.commons.RangeSlider.prototype.onsapleftmodifiers.apply(this,[e]);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onsapright=function(e){if((this.oMovingGrip===this.oGrip2&&!this.getPinGrip2())||(this.oMovingGrip===this.oGrip&&!this.getPinGrip())){sap.ui.commons.RangeSlider.prototype.onsapright.apply(this,[e]);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onsapleft=function(e){if((this.oMovingGrip===this.oGrip2&&!this.getPinGrip2())||(this.oMovingGrip===this.oGrip&&!this.getPinGrip())){sap.ui.commons.RangeSlider.prototype.onsapleft.apply(this,[e]);}};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onclick=function(e){var m=this.oMovingGrip;if(this.getEditable()&&this.getEnabled()){var f;var s=e.target.getAttribute('ID');var n=this.getValue();var N=this.getOffsetLeft(this.oGrip)+this.iShiftGrip;switch(s){case(this.oBar.id):case(this.oHiLi.id):if(this.getVertical()){f=this.getBarWidth()-this.getOffsetX(e);}else{f=this.getOffsetX(e);}if(s===this.oHiLi.id){if(this.getVertical()){f-=this.getOffsetLeft(this.oHiLi);}else{f+=this.getOffsetLeft(this.oHiLi);}}n=this.convertRtlValue(this.getMin()+(((this.getMax()-this.getMin())/this.getBarWidth())*f));N=this.getOffsetX(e);if(s===this.oHiLi.id){N+=this.getOffsetLeft(this.oHiLi);}if(this.oStartTarget&&this.targetIsGrip(this.oStartTarget.id)){m=this.oStartTarget;}else if(this.targetIsGrip(s)){m=e.target;}else{m=this.getNearestGrip(N);}break;case(this.getId()+'-left'):N=0;if(this.getVertical()){n=this.getMax();m=this.getRightGrip();}else{n=this.getMin();m=this.getLeftGrip();}break;case(this.getId()+'-right'):N=this.getBarWidth();if(!this.getVertical()){n=this.getMax();m=this.getRightGrip();}else{n=this.getMin();m=this.getLeftGrip();}break;default:if(this.targetIsGrip(s)){return;}var t=s.search('-tick');if(t>=0){var T=parseInt(s.slice(this.getId().length+5),10);N=this.fTickDist*T;n=this.convertRtlValue(this.getMin()+(((this.getMax()-this.getMin())/this.getTotalUnits())*T));if(this.oStartTarget&&this.targetIsGrip(this.oStartTarget.id)){m=this.oStartTarget;}else if(this.targetIsGrip(s)){m=e.target;}else{m=this.getNearestGrip(N);}break;}var o=jQuery(this.oBar).offset();var O=jQuery(e.target).offset();if(this.getVertical()){N=this.getOffsetX(e)-(o.top-O.top);}else{N=this.getOffsetX(e)-(o.left-O.left);}if(N<=0){N=0;if(this.getVertical()){n=this.getMax();}else{n=this.getMin();}}else{if(N>=this.getBarWidth()){N=this.getBarWidth();if(this.getVertical()){n=this.getMin();}else{n=this.getMax();}}else{if(this.getVertical()){f=this.getBarWidth()-N;}else{f=N;}n=this.getMin()+(((this.getMax()-this.getMin())/this.getBarWidth())*f);}}n=this.convertRtlValue(n);if(this.oStartTarget&&this.targetIsGrip(this.oStartTarget.id)){m=this.oStartTarget;}else if(this.targetIsGrip(s)){m=e.target;}else{m=this.getNearestGrip(N);}break;}if((m===this.oGrip2&&this.getPinGrip2())||(m===this.oGrip&&this.getPinGrip())){return;}var v=this.validateNewPosition(n,N,m,(this.getValueForGrip(m)>n));n=v.fNewValue;N=v.iNewPos;this.changeGrip(n,N,m);this.handleFireChange();}m.focus();this.oMovingGrip=m;this.oStartTarget=null;};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onkeydown=function(e){this.oMovingGrip.setAttribute('aria-busy','true');};sap.suite.ui.commons.DateRangeSliderInternal.prototype.onkeyup=function(e){this.oMovingGrip.setAttribute('aria-busy','false');};}());
