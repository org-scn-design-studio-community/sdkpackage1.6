/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.suite.ui.commons.FeedTile");jQuery.sap.require("sap.suite.ui.commons.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.suite.ui.commons.FeedTile",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{"displayDuration":{type:"int",group:"Misc",defaultValue:5},"displayArticleImage":{type:"boolean",group:"Behavior",defaultValue:true},"source":{type:"string",group:"Misc",defaultValue:null},"defaultImages":{type:"sap.ui.core.URI[]",group:"Misc",defaultValue:null}},aggregations:{"items":{type:"sap.suite.ui.commons.FeedItem",multiple:true,singularName:"item"}},events:{"press":{}}}});sap.suite.ui.commons.FeedTile.M_EVENTS={'press':'press'};(function(){sap.suite.ui.commons.FeedTile.prototype.init=function(){this._currentItemIndex=0;this._stagedModel=null;this._defaultImageIndex=-1;};sap.suite.ui.commons.FeedTile.prototype.cycle=function(){if(this._stagedModel){jQuery.sap.log.debug("FeedTile: Updating news tile with new model");this.setModel(this._stagedModel);this._stagedModel=null;var n=this.getItems().length;if(this._currentItemIndex>=n){this._currentItemIndex=0;}return;}var i=this.getItems();this._currentItemIndex=(this._currentItemIndex+1)%i.length;var $=jQuery("#"+this.getId()+"-next-feedTileImage");var a=jQuery("#"+this.getId()+"-feedTileImage");var f=this;if(jQuery.support.cssTransitions){$.addClass("sapSuiteFTItemRight").removeClass('sapSuiteFTItemHidden');a.addClass('sapSuiteFTItemCenter');setTimeout(function(){var o=false;var A=null;A=function(){jQuery(this).unbind("webkitTransitionEnd transitionend");if(!o){o=true;}else{$.removeClass("sapSuiteFTItemSliding");a.removeClass("sapSuiteFTItemSliding").addClass("sapSuiteFTItemHidden").removeClass("sapSuiteFTItemLeft").addClass("sapSuiteFTItemRight");a.detach();$.after(a);f.flipIds($,a);setTimeout(function(){f.setNextItemValues(f);},100);f._timeoutId=setTimeout(function(){f.cycle();},f.getDisplayDuration()*1000);}};a.bind("webkitTransitionEnd transitionend",A);$.bind("webkitTransitionEnd transitionend",A);a.addClass('sapSuiteFTItemSliding').removeClass('sapSuiteFTItemCenter').addClass('sapSuiteFTItemLeft');$.addClass('sapSuiteFTItemSliding').removeClass('sapSuiteFTItemRight').addClass('sapSuiteFTItemCenter');},60);}else{$.css("left","100%");$.removeClass("sapSuiteFTItemHidden");$.animate({left:"0%"},400);a.animate({left:"-100%"},400,function(){a.addClass("sapSuiteFTItemHidden");a.css("left","0");f.flipIds($,a);setTimeout(function(){f.setNextItemValues(f);},100);f._timeoutId=setTimeout(function(){f.cycle();},f.getDisplayDuration()*1000);});}};sap.suite.ui.commons.FeedTile.prototype.onAfterRendering=function(){var d=this.getDisplayDuration()*1000;var t=this;if(this.getItems().length>1){if(typeof this._timeoutId==="number"){clearTimeout(this._timeoutId);delete this._timeoutId;}this._timeoutId=setTimeout(function(){t.cycle();},d);}};sap.suite.ui.commons.FeedTile.prototype.onclick=function(e){var c=this.getCurrentItem();var i="";if(c&&c.getId()){i=c.getId();}this.firePress({itemId:i});};sap.suite.ui.commons.FeedTile.prototype.getCurrentItem=function(){var i=this.getItems();if(i.length){return i[this._currentItemIndex];}};sap.suite.ui.commons.FeedTile.prototype.getNextItem=function(){var i=this.getItems();if(i.length&&i.length>1){return i[(this._currentItemIndex+1)%i.length];}};sap.suite.ui.commons.FeedTile.prototype.setNextItemValues=function(){var n=this.getNextItem();var i=this.getId();var b=n.getImage();if(!b||!this.getDisplayArticleImage()){b=this.getDefaultImage();}jQuery("#"+i+"-next-feedTileImage").css("background-image","url("+jQuery.sap.encodeCSS(b)+")");jQuery("#"+i+"-next-feedTileTitle").html(jQuery.sap.encodeHTML(n.getTitle()));jQuery("#"+i+"-next-feedTileSource").html(jQuery.sap.encodeHTML(n.getSource()));jQuery("#"+i+"-next-feedTileAge").html(jQuery.sap.encodeHTML(sap.suite.ui.commons.util.FeedItemUtils.calculateFeedItemAge(n.getPublicationDate())));};sap.suite.ui.commons.FeedTile.prototype.flipIds=function($,a){var i=this.getId();a.attr("id",i+"-next-feedTileImage");a.find("#"+i+"-feedTileText").attr("id",i+"-next-feedTileText");a.find("#"+i+"-feedTileTitle").attr("id",i+"-next-feedTileTitle");a.find("#"+i+"-feedTileSource").attr("id",i+"-next-feedTileSource");a.find("#"+i+"-feedTileAge").attr("id",i+"-next-feedTileAge");$.attr("id",i+"-feedTileImage");$.find("#"+i+"-next-feedTileText").attr("id",i+"-feedTileText");$.find("#"+i+"-next-feedTileTitle").attr("id",i+"-feedTileTitle");$.find("#"+i+"-next-feedTileSource").attr("id",i+"-feedTileSource");$.find("#"+i+"-next-feedTileAge").attr("id",i+"-feedTileAge");};sap.suite.ui.commons.FeedTile.prototype.setDisplayDuration=function(d){if(d<3){d=3;jQuery.sap.log.error("FeedTile: displayDuration should be equal or more than 3 seconds.");}this.setProperty("displayDuration",d);};sap.suite.ui.commons.FeedTile.prototype.stageModel=function(m){this._stagedModel=m;};sap.suite.ui.commons.FeedTile.prototype.getDefaultImage=function(){var d="";var D=this.getDefaultImages();if(D&&D.length>0){var l=D.length;if(this._defaultImageIndex===-1){var r=Math.floor(Math.random()*l);this._defaultImageIndex=r;d=D[r];}else{var i=(this._defaultImageIndex+1)>=l?0:this._defaultImageIndex+1;this._defaultImageIndex=i;d=D[i];}}return d;};sap.suite.ui.commons.FeedTile.prototype.setDefaultImages=function(d){if(d&&d.length>0){var v=[];var D=null;for(var i=0;i<d.length;i++){D=d[i];var a=jQuery.sap.validateUrl(D);if(a){v.push(D);}else{jQuery.sap.log.error("Invalid Url:'"+D);}}if(v.length<=0){jQuery.sap.log.error("Default Images are not set because supplied Urls are invalid");}else{this.setProperty("defaultImages",v);}}};}());
